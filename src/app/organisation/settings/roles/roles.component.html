<div class="card">
  <div class="card-header">
    <button class="btn btn-sm btn-primary" (click)="showEditor($event)">
        <i class="fa fa-plus-circle"></i> Add New Role
    </button>
  </div>

  <table class="table table-bordered table-hover">
    <thead>
      <tr>
        <th colspan="2">Name</th>
        <th class="text-center">Permissions</th>
        <th class="text-center">Accounts</th>
        <th class="text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let role of roles; let row = index">
        <td class="text-right">{{ row + 1 }}.</td>
        <td>
          <div>{{ role.name }}</div>
          <div class="text-muted small">{{ role.description }}</div>
        </td>
        <td class="text-center">
          {{ role.permissions_count }}
        </td>
        <td class="text-center">
          {{ role.organisation_account_count }}
        </td>
        <td class="text-center">
          <button class="btn btn-xs btn-primary m-r-5" (click)="viewPermissions(role)">
            <i class="fa fa-lock fa-fw"></i> Permissions
          </button>

          <button class="btn btn-xs btn-info m-r-5" (click)="showEditor($event, role)">
            <i class="fa fa-pencil fa-fw"></i> Edit
          </button>

          <button class="btn btn-xs btn-danger" (click)="deleteRole(role)">
            <i class="fa fa-trash-o fa-fw"></i> Delete
          </button>
        </td>
      </tr>
    </tbody>
  </table>

</div>


<ng-template #editorModal let-modal>
  <form class="form-horizontal theme-form" (ngSubmit)="onSubmit($event)" [formGroup]='editorForm'>

    <div class="modal-header">
      <h4 class="modal-title">{{modalTitle}}</h4>
      <button type="button" class="close basic-close" (click)="hideModal()">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>

    <div class="modal-body">

      <div class="form-group">
        <div class="col-sm-4 col-form-label">
          <i class="fa fa-shield"></i> Name
        </div>
        <div class="col-sm">
          <input type="text" class="form-control" formControlName="name" placeholder="e.g. Officer" />

          <div class="messages text-danger" *ngIf="editorForm.controls.name.errors?.required">
            <p>Role name required</p>
          </div>
        </div>
      </div>

      <div class="form-group">
        <div class="col-sm-4 col-form-label">
          <i class="fa fa-file-text"></i> Description
        </div>
        <div class="col-sm">
          <input type="text" class="form-control" formControlName="description"
                 placeholder="e.g Something brief about this role" />
        </div>
      </div>


    </div>

    <div class="modal-footer flex-grow-1 text-right">
      <span class="m-r-15" *ngIf="saving && roleService.requesting">
        <i class="fa fa-spin fa-circle-o-notch"></i> Saving
      </span>

      <button type="submit" class="btn btn-primary ripple light">Save Changes</button>
      <button type="button" class="btn btn-outline-danger ripple" (click)="hideModal()">Close</button>
    </div>

  </form>
</ng-template>

<app-permissions #permissions [role]="selectedRole"></app-permissions>
